---
title: "Change in PA"
format: html
editor: visual
editor_options: 
  chunk_output_type: console
---

## Information

This script contains the analyses for change in LTPA across H1-H3-H4.

Due to different phrasing of the PA questions in HUNT 2, these analyses **will only consider longitudinal trends from H1-H3-H4**. That is, across four decades, with 10 years between 10 years between H3-H4, 22 years between H1-H3 and 32 years between H1-H3-H4.

## Set environment and load packages

```{r setup}

knitr::opts_chunk$set(
  warning = FALSE,
  message = FALSE
)
```

```{r}

library(dplyr)
library(tibble)
library(lubridate)
library(readr)
library(forcats)
library(survival)
```

## Longitudinal trends across H1-H3-H4

In order to perform the analyses, we must filter out participants as follows:

-   H3-H4: Participants who have LTPA data in H3 and H4.
-   H1-H3: Participants who have LTPA data in H1 and H3.
-   H1-H3-H4: Participants who have LTPA data in H1, H3 and H4.

These operations are in **data_preparation.qmd**

Then, we must used their exercise data to create LTPA groups.

The process of differentiating participants into LTPA groups are done in Stata. Code can be located in the same GitHub repository as the rest of the code. Therefore, we will only load in a .csv file that's been processed in Stata and do the analyses on those. However, we will create a LTPA trajectory variable as preliminary for the analyses here in R.

### H1-H3

#### Process data

Load data that's been processed in Stata:

```{r}

hunt_1_3 <- read_csv("//fil.nice.ntnu.no/nice/p758/data/my_data/hunt_1_3.csv")
```

Process data that's been lost in the Stata process, i.e., create factor variable types and set reference value in the trajectory group. 

```{r}

glimpse(hunt_1_3)

hunt_1_3 <- hunt_1_3 |> 
  process_hunt_1_3() |> 
  mutate(
    death_all = as_factor(death_all)
  )
```

#### Analyses

The covariates are the same for all surveys because we have used data at baseline.

Crude:

```{r}

crude_covariates <- c("age", "sex", "trajectory_group")

run_cox_reg(
  hunt_1_3,
  time = follow_up_time,
  status = death_all,
  covariates = crude_covariates
)
```

Multi-adjusted:

```{r}

multi_adj_covariates_h1_h3_h4 <- c(
  "age", 
  "sex", 
  "trajectory_group",
  "bp_syst2_nt1blm",
  "bmi_nt1blm",
  "alc_fl2w_nt1blq2",
  "smo_stat_nt1blq2"
  )

run_cox_reg(
  data = hunt_1_3,
  time = follow_up_time,
  status = death_all,
  covariates = multi_adj_covariates_h1_h3_h4
)
```

### H1-H3-H4

#### Process data

Load data that's been processed in Stata:

```{r}

hunt_1_3_4 <- read_csv("//fil.nice.ntnu.no/nice/p758/data/my_data/hunt_1_3_4.csv")
```

Process data that's been lost in the Stata process:

```{r}

glimpse(hunt_1_3_4)

hunt_1_3_4 <- hunt_1_3_4 |> 
  process_hunt_1_3_4()
```

#### Analyses

Crude:

```{r}

run_cox_reg(
  hunt_1_3_4,
  time = follow_up_time,
  status = death_all,
  covariates = crude_covariates
) |> 
  view()
```

Multi-adjusted:

```{r}

run_cox_reg(
  data = hunt_1_3_4,
  time = follow_up_time,
  status = death_all,
  covariates = multi_adj_covariates_h1_h3_h4
)
```

### H3-H4

#### Process data

```{r}

hunt_3_4 <- read_csv("//fil.nice.ntnu.no/nice/p758/data/my_data/hunt_3_4.csv")
```

Process data that's been lost in the Stata process:

```{r}

glimpse(hunt_3_4)

hunt_3_4 <- hunt_3_4 |> 
  process_hunt_3_4()

```

#### Analyses

Crude:

```{r}

run_cox_reg(
  hunt_3_4,
  time = follow_up_time,
  status = death_all,
  covariates = crude_covariates
) |> 
  view()
```


Multi-adjusted:

```{r}

multi_adj_covariates_h3_h4 <- c(
  "age",
  "sex", 
  "trajectory_group",
  "bp_syst_mn23_nt3blm",
  "bmi_nt3blm",
  "alc_fly_nt3blq1",
  "smo_stat_nt3blq1"
)
```
